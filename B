
# --- helpers ----------------------------------------------------------------
function Get-NonInteractiveCredential {
    param($UserEnvVar,$PassEnvVar)
    if ($env:$UserEnvVar -and $env:$PassEnvVar) {
        $sec = ConvertTo-SecureString $env:$PassEnvVar -AsPlainText -Force
        return [pscredential]::new($env:$UserEnvVar, $sec)
    }
    return $null
}

# Prefer parameter, else env vars, else throw (to keep Jenkins non-interactive)
if (-not $Cred) { $Cred = Get-NonInteractiveCredential -UserEnvVar $UserEnvVar -PassEnvVar $PassEnvVar }
if (-not $Cred) { throw "No credentials provided. In Jenkins, use withCredentials() to set $UserEnvVar/$PassEnvVar." }

# ScriptBlock th
